<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8">
<html>
<head>
<title>favicon</title>
<meta name="generator" content="Editplus" />
<meta name="author" content="闲耘 (mail[AT]xianyun.org)" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
<img id="favicon" style="display:;" />
<script type="text/javascript" language="javascript">/*<![CDATA[*/

var $ = function(id){
	return document.getElementById(id);
};
/**
 * @param {String}, d domain.
 * @param {Function} c callback.
 * @param {String} s default icon.
 */
function getFavicon(d,c,s){
	try{
		var m=/^(\w+:\/\/(?:[\w-]+\.)+[\w-]+)(?:\/[\w-.\/?%&=]*)?$/
		d = d.match(m);
		if(!d){return c(s);}
		d = d[1];
		$("favicon").src=d+"/favicon.ico";
		$("favicon").onerror=function(){
			c(s);
		};
		$("favicon").onload=function(){
			c(d+"/favicon.ico");
		};
	}catch(e){
		return "";
	}
}

function fav(){
	getFavicon($('domain').value,function(s){
		$("out").src=s;
	},"");
}

/*]]>*/</script>
<input type=text id="domain" />
<input type=button onclick="fav()" value="Get" /><br />
<img src="" id="out" style="border:1px solid #ccc;width:16px;height:16px;" />
</body>
</html>