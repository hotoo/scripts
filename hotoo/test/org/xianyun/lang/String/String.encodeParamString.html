<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8">
<html>
<head>
<title>String.encodeParamString, String.decodeParamString</title>
<meta name="generator" content="Editplus" />
<meta name="author" content="闲耘 (mail[AT]xianyun.org)" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
<div id="line">line
new line
3rd line.</div>
<script type="text/javascript" language="javascript">/*<![CDATA[*/

var URL=function(){};
URL.param = function(u, n){
	var v = u.replace(
	  new RegExp(".*(?:\\?|&|\\b)"+n+"=(.*?)(?:&|#|$).*","i"), "$1");
	return v===u||v==="&"||v==="#"?"":v;
};
URL.params = function(u, n){
	var p = [];
	var a = u.match(new RegExp("(?:\\?|&|\\b)"+(n||"(.*?)")+"=.+?(?:\\b|&|#|$)","ig"));
	var r=/(.*?)=(.+?)(?:&|#|$)/;
	if (a && a instanceof Array && a.length>0){
		for (var i=0; i<a.length; i++){
		//	p[p.length] = URL.param(a[i], n);
		//	p[p.length] = a[i].replace(/.*?=(.+?)(?:&|#|$)/, "$1");
			t=a[i].match(r);
			p[p.length] = n?t[1]:[t[1],t[2]];
		}
	}
	return p;
};
alert(URL.params("a=b&c=d"));
//alert(document.getElementById("line").innerHTML);
Array.prototype.each = function(iterator){
	var r=[];
	for (var i=0; i<this.length; i++)
		r[i]=iterator.call(this, this[i], i, this);
	return r;
//	for (var i=0,l=this.length; i<l; i++)
//		iterator(this[i], i, this);
};
/**
 * @overview 将键值对格式字符串（类似URL参数串）进行编码，仅编码参数值。
 *
 */
String.prototype.encodeParamString=function(){
//	var s=URL.params(URL.paramString(this)||this);
	var s=[{key:"name",value:"名字"},{key:"nick",value:"昵称"}];
	return s.each(function(o,i,a){return o.key+"="+encodeURIComponent(o.value);}).join("&");
};
String.prototype.decodeParamString=function(){
	return
};
//alert("".encodeParamString().decodeParamString());
/*]]>*/</script>
</body>
</html>